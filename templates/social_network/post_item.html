{% for post in posts %}
  <a href="{% url 'posts:post_detail' post.pk %}" class="post-link">
    <div class="post">
      <div class="post-header">
        <div class="post-author">
          {{ post.author.get_display_name }} 
          {% if post.author.handle %}<a href="{% url 'users:user_detail' post.author.handle %}" onclick="event.stopPropagation();">@{{ post.author.handle }}</a>{% else %}@unknown{% endif %}
        </div>
        <div class="post-date">{{ post.created_at|date:"d.m.Y H:i" }}</div>
      </div>

      <div class="post-text">{{ post.content }}</div>

      {% if post.thumbnail_url %}
        <div class="post-media">
          <img src="/media/{{ post.thumbnail_url }}" alt="">
        </div>
      {% elif post.images or post.videos %}
        <div class="post-media">
          {% if post.images %}
            <img src="{{ post.images.0.file.url }}" alt="">
          {% elif post.videos %}
            <video controls><source src="{{ post.videos.0.file.url }}" type="video/mp4"></video>
          {% endif %}
        </div>
      {% endif %}

      <div class="post-actions">
        <form method="post" action="{% url 'reactions:post_like' post.pk %}" onclick="event.stopPropagation();">
          {% csrf_token %}
          <button type="submit">â™¥ {{ post.likes.count }}</button>
        </form>
        <span class="comment-count">ðŸ’¬ {{ post.comments.count }}</span>
        {% if user.is_authenticated and user == post.author %}
          <button type="button" onclick="event.stopPropagation();window.location.href='{% url 'posts:post_update' post.pk %}';">Edit</button>
          <button type="button" class="btn-danger" onclick="event.stopPropagation();window.location.href='{% url 'posts:post_delete' post.pk %}';">Del</button>
        {% endif %}
      </div>
    </div>
  </a>
{% endfor %}