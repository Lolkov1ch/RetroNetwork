{% extends 'base.html' %}

{% block title %}{{ post.title }} - RetroNetwork{% endblock %}

{% block content %}
<div class="post-detail">
  <a href="{% url 'posts:post_list' %}" class="back-link">‚Üê Back to Posts</a>
  
  <h1>{{ post.title }}</h1>
  <div class="post-meta">
    <p>By <a href="{% url 'users:user_detail' post.author.handle %}">@{{ post.author.handle }}</a></p>
    <p>Posted on {{ post.created_at|date:"F d, Y H:i" }}</p>
    {% if post.updated_at != post.created_at %}
      <p><em>Edited on {{ post.updated_at|date:"F d, Y H:i" }}</em></p>
    {% endif %}
  </div>
  
  <div class="post-description">
    {{ post.description }}
  </div>
  
  {% if media_files %}
    <div class="media-container">
      {% for media in media_files %}
        {% if media.is_image %}
          <div class="media-item">
            <img src="{{ media.file.url }}" alt="Post image">
          </div>
        {% elif media.is_video %}
          <div class="media-item">
            <video width="100%" controls>
              <source src="{{ media.file.url }}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
          </div>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <div style="margin-top: 1rem;">
    <form method="post" action="{% url 'reactions:post_like' post.pk %}" style="display: inline;">
      {% csrf_token %}
      <button type="submit">‚ù§Ô∏è Like ({{ post.likes.count }})</button>
    </form>
    {% if user.is_authenticated and user == post.author %}
      <a href="{% url 'posts:post_update' post.pk %}" style="margin-left: 1rem; color: #0066cc; text-decoration: none;">‚úèÔ∏è Edit Post</a>
      <a href="{% url 'posts:post_delete' post.pk %}" style="margin-left: 1rem; color: #0066cc; text-decoration: none;">üóëÔ∏è Delete Post</a>
    {% endif %}
  </div>

  <div class="comments-section">
    <h3>Comments ({{ post.comments.count }})</h3>
    
    {% if post.comments.all %}
      <div class="comments-list">
        {% for comment in post.comments.all %}
          <div class="comment">
            <div class="comment-content">
              {{ comment.content }}
            </div>
            <div class="comment-meta">
              <strong><a href="{% url 'users:user_detail' comment.author.handle %}">@{{ comment.author.handle }}</a></strong>
              <span>{{ comment.created_at|date:"M d, Y H:i" }}</span>
            </div>
            <div class="comment-actions">
              <form method="post" action="{% url 'reactions:comment_like' comment.pk %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit">‚ù§Ô∏è {{ comment.likes.count }}</button>
              </form>
              {% if user.is_authenticated and user == comment.author %}
                <a href="{% url 'comments:comment_edit' comment.pk %}">Edit</a>
                <form method="post" action="{% url 'comments:comment_delete' comment.pk %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this comment?');">
                  {% csrf_token %}
                  <button type="submit">Delete</button>
                </form>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="no-comments">No comments yet. Be the first to comment!</p>
    {% endif %}

    {% if user.is_authenticated %}
      <div class="add-comment-form">
        <h4>Add a Comment</h4>
        <form method="post" action="{% url 'comments:post_add_comment' post.pk %}">
          {% csrf_token %}
          <textarea name="content" required placeholder="Share your thoughts..."></textarea>
          <button type="submit">Post Comment</button>
        </form>
      </div>
    {% else %}
      <div class="login-prompt">
        <p><a href="{% url 'users:login' %}">Log in</a> to comment on this post.</p>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
