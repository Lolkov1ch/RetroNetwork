{% extends 'base.html' %}
{% block title %}RetroNetwork | My Page{% endblock %}

{% block content %}

<div class="panel">
  <div class="panel-header">[ My Page ]</div>
  <div class="panel-body" style="padding:0;">

    <div class="profile-header">
      <div class="profile-avatar">
        {% if user.avatar %}
          <img src="{{ user.avatar.url }}" alt="Avatar">
        {% else %}
          <div class="profile-avatar-placeholder">ðŸ‘¤</div>
        {% endif %}
      </div>
      <div class="profile-info">
        <h1>{{ user.get_display_name }}</h1>
        <p class="profile-handle">@{{ user.handle }}<span class="online-dot"></span></p>
        {% if user.bio %}<p class="profile-bio">{{ user.bio }}</p>{% endif %}
      </div>
    </div>

    <table class="profile-table">
      <tr><td>Handle</td><td>@{{ user.handle }}</td></tr>
      <tr><td>Email</td><td>{{ user.email }}</td></tr>
      <tr><td>Followers</td><td>{{ user.followers.count }}</td></tr>
      {% if user.birth_date %}
        <tr><td>Birth Date</td><td>{{ user.birth_date }}</td></tr>
      {% endif %}
      {% if user.address %}
        <tr><td>Address</td><td>{{ user.address }}</td></tr>
      {% endif %}
    </table>

    <div class="profile-actions-bar">
      <a href="{% url 'user_settings:edit_profile' %}" class="btn">Edit Profile</a>
      <a href="{% url 'user_settings:change_password' %}" class="btn">Change Password</a>
      <a href="{% url 'user_settings:notification_settings' %}" class="btn">Notifications</a>
      <a href="{% url 'user_settings:privacy_settings' %}" class="btn">Privacy</a>
      <form method="post" action="{% url 'logout' %}" style="margin-left:auto;">
        {% csrf_token %}
        <button type="submit" class="nav-logout">Log out</button>
      </form>
    </div>

  </div>
</div>

<div class="panel">
  <div class="panel-header">[ My Posts ]</div>
  <div class="panel-body" style="padding:6px;">
    {% if posts %}
      <div class="user-posts">
        {% for post in posts %}
          <a href="{% url 'posts:post_detail' post.id %}" class="post-link">
            <div class="user-post">
              {% if post.thumbnail_url %}
                <div class="user-post-thumbnail-container">
                  <img src="{{ post.thumbnail_url }}" alt="{{ post.title }}">
                  <div class="user-post-thumbnail-overlay"></div>
                </div>
              {% elif post.images %}
                <div class="user-post-thumbnail-container">
                  <img src="{{ post.images.0.file.url }}" alt="{{ post.title }}">
                  <div class="user-post-thumbnail-overlay"></div>
                </div>
              {% elif post.videos %}
                <div class="user-post-thumbnail-container">
                  <video muted preload="metadata">
                    <source src="{{ post.videos.0.file.url }}" type="video/mp4">
                  </video>
                  <div class="user-post-thumbnail-overlay"></div>
                </div>
              {% endif %}
              <h3 class="user-post-title">{{ post.title }}</h3>
              <p class="user-post-description">{{ post.description }}</p>
              <small class="user-post-date">{{ post.created_at|date:"d.m.Y H:i" }}</small>
            </div>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="empty-state">
        // No posts yet. <a href="{% url 'posts:post_create' %}">Create one?</a>
      </div>
    {% endif %}
  </div>
</div>

{% endblock %}