# RetroNetwork

A modern, feature-rich social network application built with Django, Django REST Framework, and Django Channels for real-time WebSocket communication. Fully containerized and deployable to Render.com.

## Features

- **ğŸ‘¥ User Profiles** â€” Customizable profiles with bio, avatar, cover image, and status
- **ğŸ“ Posts & Comments** â€” Create posts, comment, edit, and delete with rich text support
- **â¤ï¸ Reactions** â€” Like posts, react to messages with emoji
- **ğŸ’¬ Real-time Messaging** â€” WebSocket-based instant messaging with typing indicators and presence
- **ğŸ”” Notifications** â€” Real-time notifications for follows, likes, comments, and messages
- **ğŸ”’ Privacy & Security** â€” Block/unblock users, followers/following management, privacy settings
- **ğŸ“ Media Handling** â€” Upload images, videos, and documents with validation
- **ğŸ” Search** â€” Full-text search for posts and users
- **ğŸŒ“ Dark Theme** â€” Built-in light and dark theme support
- **ğŸ” Authentication** â€” Email, username, or handle login with custom backend

## Tech Stack

| Component | Technology |
|-----------|-----------|
| **Backend** | Django 6.0.2 |
| **API** | Django REST Framework 3.16.1 |
| **Real-time** | Django Channels 4.3.2 + WebSockets |
| **Database** | PostgreSQL 18 (Render managed or local) |
| **Cache/Messaging** | Redis 7 |
| **ASGI Server** | Daphne 4.2.1 |
| **Web Server** | Gunicorn 25.1.0 (production) |
| **Media** | Pillow 12.1.0 |
| **Static Files** | Whitenoise 6.12.0 |

## Quick Start

### Local Development (with PostgreSQL & Redis)

1. **Clone and navigate**
   ```bash
   git clone https://github.com/Lolkov1ch/RetroNetwork.git
   cd RetroNetwork
   ```

2. **Create Python virtual environment**
   ```bash
   python -m venv venv
   # Windows
   .\venv\Scripts\activate
   # macOS/Linux
   source venv/bin/activate
   ```

3. **Install dependencies**
   ```bash
   pip install -r requirements.txt
   ```

4. **Setup environment variables**
   ```bash
   cp .env.example .env
   # Edit .env and set your SECRET_KEY and DATABASE_URL
   ```

5. **Run migrations**
   ```bash
   python manage.py migrate
   ```

6. **Create superuser**
   ```bash
   python manage.py createsuperuser
   ```

7. **Start development server**
   ```bash
   python manage.py runserver
   ```
   App available at `http://localhost:8000` â€” Admin at `http://localhost:8000/admin/`

### Local Development with Docker Compose

1. **Clone the repository**
   ```bash
   git clone https://github.com/Lolkov1ch/RetroNetwork.git
   cd RetroNetwork
   ```

2. **Create `.env` file**
   ```bash
   cp .env.example .env
   ```

3. **Start all services** (PostgreSQL, Redis, Django app)
   ```bash
   docker-compose up -d
   ```

4. **Create superuser**
   ```bash
   docker-compose exec web python manage.py createsuperuser
   ```

5. **Access the app**
   - Application: `http://localhost:8000`
   - Admin panel: `http://localhost:8000/admin/`
   - Postgres: `localhost:5432` (user: `postgres`, password: `dev_password`)
   - Redis: `localhost:6379`

**Stop services:**
```bash
docker-compose down
```

## Deployment to Render.com

### Prerequisites
- Render.com account (free tier available)
- GitHub repository with code pushed
- PostgreSQL add-on on Render (recommended: paid tier for reliability)

### Deployment Steps

1. **Push code to GitHub**
   ```bash
   git push origin main
   ```

2. **Create Web Service on Render**
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" â†’ "Web Service"
   - Connect your GitHub repository
   - Select `RetroNetwork`
   - Set environment to **Docker**
   - Choose a region (Frankfurt recommended for EU)
   - Select **Free** plan (or Paid for better performance)

3. **Create PostgreSQL Database** (if not using Render managed service)
   - New PostgreSQL instance on Render
   - Note the `DATABASE_URL`

4. **Add Environment Variables** in Render Web Service settings:
   ```
   SECRET_KEY        = [auto-generated by Render]
   DEBUG             = False
   ALLOWED_HOSTS     = your-service-name.onrender.com
   DATABASE_URL      = [your PostgreSQL connection string]
   REDIS_URL         = [optional: redis://:password@host:port]
   ```

5. **Deploy**
   - Render automatically builds from `Dockerfile.prod`
   - Migrations run automatically on startup
   - Service health checks enabled

6. **Post-Deployment**
   - Access your app: `https://your-service-name.onrender.com`
   - Check logs in Render dashboard if issues occur
   - Create superuser via Render shell:
     ```bash
     # In Render dashboard, open "Shell" and run:
     python manage.py createsuperuser
     ```

## Project Structure

```
RetroNetwork/
â”œâ”€â”€ social_core/              # Main Django project settings
â”‚   â”œâ”€â”€ settings.py          # Configuration (DB, installed apps, middleware)
â”‚   â”œâ”€â”€ asgi.py              # ASGI config for Channels
â”‚   â”œâ”€â”€ wsgi.py              # WSGI config for Gunicorn
â”‚   â””â”€â”€ urls.py              # Main URL routing
â”‚
â”œâ”€â”€ users/                   # User authentication & profiles
â”‚   â”œâ”€â”€ models.py            # User, Follow, Block models
â”‚   â”œâ”€â”€ views.py             # Profile views
â”‚   â”œâ”€â”€ backends.py          # Custom auth backend
â”‚   â””â”€â”€ forms.py             # User forms
â”‚
â”œâ”€â”€ posts/                   # Posts & content management
â”‚   â”œâ”€â”€ models.py            # Post model
â”‚   â”œâ”€â”€ views.py             # Post CRUD views
â”‚   â”œâ”€â”€ signals.py           # Auto-update signals
â”‚   â””â”€â”€ utils.py             # Thumbnail generation
â”‚
â”œâ”€â”€ comments/                # Comments on posts
â”‚   â”œâ”€â”€ models.py            # Comment model
â”‚   â”œâ”€â”€ views.py             # Comment views
â”‚   â””â”€â”€ signals.py           # Notifications
â”‚
â”œâ”€â”€ reactions/               # Likes & reactions
â”‚   â”œâ”€â”€ models.py            # Reaction model
â”‚   â””â”€â”€ views.py             # Reaction endpoints
â”‚
â”œâ”€â”€ messaging/               # WebSocket messaging
â”‚   â”œâ”€â”€ consumers.py         # WebSocket consumer (Channels)
â”‚   â”œâ”€â”€ models.py            # Message, Conversation models
â”‚   â”œâ”€â”€ routing.py           # WebSocket routing
â”‚   â”œâ”€â”€ serializers.py       # DRF serializers
â”‚   â””â”€â”€ views.py             # REST API views
â”‚
â”œâ”€â”€ notifications/           # Real-time notifications
â”‚   â”œâ”€â”€ models.py            # Notification model
â”‚   â”œâ”€â”€ signals.py           # Signal handlers
â”‚   â””â”€â”€ context_processors.py
â”‚
â”œâ”€â”€ attachments/             # File uploads
â”‚   â”œâ”€â”€ models.py            # Media model
â”‚   â”œâ”€â”€ validators.py        # File type & size validation
â”‚   â””â”€â”€ storage_paths.py     # Upload paths
â”‚
â”œâ”€â”€ user_settings/           # User preferences
â”‚   â”œâ”€â”€ models.py            # Privacy, theme settings
â”‚   â””â”€â”€ views.py             # Settings views
â”‚
â”œâ”€â”€ templates/               # HTML templates
â”‚   â”œâ”€â”€ base.html            # Base template
â”‚   â”œâ”€â”€ social_network/      # Post/feed templates
â”‚   â”œâ”€â”€ users/               # Profile templates
â”‚   â””â”€â”€ messenger/           # Messaging templates
â”‚
â”œâ”€â”€ static/                  # CSS, JS, images
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ img/
â”‚
â”œâ”€â”€ Dockerfile               # Development image
â”œâ”€â”€ Dockerfile.prod          # Production image (for Render)
â”œâ”€â”€ docker-compose.yml       # Local dev orchestration
â”œâ”€â”€ docker-compose.prod.yml  # Production orchestration
â”œâ”€â”€ docker-entrypoint.sh     # Dev entrypoint
â”œâ”€â”€ docker-entrypoint-prod.sh # Prod entrypoint (migrations, static)
â”œâ”€â”€ requirements.txt         # Python dependencies
â”œâ”€â”€ .env.example             # Environment template
â”œâ”€â”€ render.yaml              # Render deployment config
â””â”€â”€ manage.py                # Django CLI
```

## Security Features

- **Custom Authentication** â€” Supports email, username, or handle login
- **Password Validation** â€” Complexity checks, similarity validation
- **File Upload Validation** â€” Extension, MIME type, and size checks
- **CORS Protection** â€” Configured allowed origins
- **CSRF Protection** â€” Enabled by default
- **WebSocket Security** â€” Token authentication for real-time connections
- **Non-root Container** â€” Runs as `appuser` (UID 1000)
- **HSTS & Secure Cookies** â€” Configurable for production

## Environment Variables

See `.env.example` for all available variables:

```bash
SECRET_KEY              # Django secret key (auto-generated on Render)
DEBUG                   # Debug mode (True for dev, False for prod)
ALLOWED_HOSTS           # Comma-separated allowed domains
DATABASE_URL            # PostgreSQL connection string
REDIS_HOST              # Redis host (default: localhost)
REDIS_PORT              # Redis port (default: 6379)
CHANNEL_BACKEND         # Channels backend (InMemory or Redis)
SECURE_SSL_REDIRECT     # Enforce HTTPS
CSRF_COOKIE_SECURE      # Secure CSRF cookies
SESSION_COOKIE_SECURE   # Secure session cookies
```

## Development

### Running Tests
```bash
python manage.py test
```

### Creating Test Data
```bash
python manage.py create_test_posts
python manage.py create_test_messages
```

### Collecting Static Files (local)
```bash
python manage.py collectstatic --noinput
```

## Database Migrations

Create new migration:
```bash
python manage.py makemigrations
```

Apply migrations:
```bash
python manage.py migrate
```

## Troubleshooting

### Build fails on Render
- Check that `DATABASE_URL` is set in environment variables
- Ensure the PostgreSQL database is running
- Review logs in Render dashboard

### WebSocket connection fails
- Ensure Redis is available (set `REDIS_URL` for production)
- Check that `CHANNEL_BACKEND` is set correctly
- Verify firewall/network allows WebSocket connections

### Static files not serving
- Run `python manage.py collectstatic`
- Ensure Whitenoise is configured in settings
- Check file permissions in container

### Migration timeout
- Increase the `timeout` in docker-entrypoint-prod.sh
- Check database performance and connection

## License

MIT License â€” See [LICENSE](LICENSE) file

**For more info:** See [SECURITY.md](SECURITY.md) for deployment best practices
